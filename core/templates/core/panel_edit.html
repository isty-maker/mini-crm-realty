{% extends "base.html" %}
{% block title %}{{ prop|default:"Новый объект" }} — Мини-CRM{% endblock %}
{% block content %}
  <a href="/panel/">&larr; к списку</a>
  <h1>{{ prop|default:"Новый объект" }}</h1>

  <form method="post">
    {% csrf_token %}

    <h3>Основное</h3>
    <div class="form-row">
      {{ form.title.label_tag }}
      {{ form.title }}
    </div>
    <div class="form-row">
      {{ form.external_id.label_tag }}
      {{ form.external_id }}
    </div>
    <div class="form-row">
      {{ form.category.label_tag }}
      {{ form.category }}
    </div>
    <div class="form-row">
      {{ form.operation.label_tag }}
      {{ form.operation }}
    </div>
    <div class="form-row row-2">
      <div class="form-row">
        {{ form.price.label_tag }}
        {{ form.price }}
      </div>
      <div class="form-row">
        {{ form.currency.label_tag }}
        {{ form.currency }}
      </div>
    </div>

    <h3>Адрес</h3>
    <div class="form-row">
      {{ form.city.label_tag }}
      {{ form.city }}
    </div>
    <div class="form-row">
      {{ form.address.label_tag }}
      {{ form.address }}
    </div>
    <div class="form-row row-2">
      <div class="form-row">
        {{ form.lat.label_tag }}
        {{ form.lat }}
      </div>
      <div class="form-row">
        {{ form.lng.label_tag }}
        {{ form.lng }}
      </div>
    </div>
    <div class="form-row">
      {{ form.cadastral_number.label_tag }}
      {{ form.cadastral_number }}
    </div>

    <h3>Площади и этаж</h3>
    <div class="form-row">
      {{ form.rooms.label_tag }}
      {{ form.rooms }}
    </div>
    <div class="form-row">
      {{ form.area_total.label_tag }}
      {{ form.area_total }}
    </div>
    <div class="form-row">
      {{ form.area_living.label_tag }}
      {{ form.area_living }}
    </div>
    <div class="form-row">
      {{ form.area_kitchen.label_tag }}
      {{ form.area_kitchen }}
    </div>
    <div class="form-row row-2">
      <div class="form-row">
        {{ form.floor.label_tag }}
        {{ form.floor }}
      </div>
      <div class="form-row">
        {{ form.floors_total.label_tag }}
        {{ form.floors_total }}
      </div>
    </div>

    <h3>Характеристики</h3>
    <div class="form-row">
      <label>{{ form.is_euro_flat }} Европланировка</label>
    </div>
    <div class="form-row">
      <label>{{ form.is_apartments }} Апартаменты</label>
    </div>
    <div class="form-row">
      <label>{{ form.is_penthouse }} Пентхаус</label>
    </div>
    <div class="form-row">
      {{ form.balconies_count.label_tag }}
      {{ form.balconies_count }}
    </div>
    <div class="form-row">
      {{ form.loggias_count.label_tag }}
      {{ form.loggias_count }}
    </div>
    <div class="form-row">
      {{ form.separate_wcs_count.label_tag }}
      {{ form.separate_wcs_count }}
    </div>
    <div class="form-row">
      {{ form.combined_wcs_count.label_tag }}
      {{ form.combined_wcs_count }}
    </div>
    <div class="form-row">
      {{ form.repair_type.label_tag }}
      {{ form.repair_type }}
    </div>
    <div class="form-row">
      {{ form.windows_view_type.label_tag }}
      {{ form.windows_view_type }}
    </div>
    <div class="form-row">
      <label>{{ form.has_internet }} Интернет</label>
    </div>
    <div class="form-row">
      <label>{{ form.has_furniture }} Есть мебель</label>
    </div>
    <div class="form-row">
      <label>{{ form.has_phone }} Телефонная линия</label>
    </div>
    <div class="form-row">
      <label>{{ form.has_kitchen_furniture }} Мебель на кухне</label>
    </div>

    <h3>Метро (до 3 станций)</h3>
    <div class="form-row">
      {{ form.metro1_id.label_tag }}
      {{ form.metro1_id }}
    </div>
    <div class="form-row row-2">
      <div class="form-row">
        {{ form.metro1_time.label_tag }}
        {{ form.metro1_time }}
      </div>
      <div class="form-row">
        {{ form.metro1_transport_type.label_tag }}
        {{ form.metro1_transport_type }}
      </div>
    </div>
    <div class="form-row">
      {{ form.metro2_id.label_tag }}
      {{ form.metro2_id }}
    </div>
    <div class="form-row row-2">
      <div class="form-row">
        {{ form.metro2_time.label_tag }}
        {{ form.metro2_time }}
      </div>
      <div class="form-row">
        {{ form.metro2_transport_type.label_tag }}
        {{ form.metro2_transport_type }}
      </div>
    </div>
    <div class="form-row">
      {{ form.metro3_id.label_tag }}
      {{ form.metro3_id }}
    </div>
    <div class="form-row row-2">
      <div class="form-row">
        {{ form.metro3_time.label_tag }}
        {{ form.metro3_time }}
      </div>
      <div class="form-row">
        {{ form.metro3_transport_type.label_tag }}
        {{ form.metro3_transport_type }}
      </div>
    </div>

    <div class="form-row">
      {{ form.description.label_tag }}
      {{ form.description }}
    </div>

    <button type="submit">Сохранить</button>
  </form>

  {% if prop %}
    <h3>Фотографии</h3>
    <form method="post" action="/panel/edit/{{ prop.pk }}/add-photo/" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="image" required>
      <label><input type="checkbox" name="is_main"> Сделать главной</label>
      <button>Загрузить</button>
    </form>

    <div class="photos" style="margin-top:1rem">
      {% for ph in photos %}
        <figure>
          <img src="{{ ph.image_url }}" alt="photo {{ forloop.counter }}">
          <figcaption>
            {% if ph.is_main %}
              <span class="tag">главное</span>
            {% else %}
              <form method="post" action="/panel/photo/{{ ph.pk }}/make-main/" style="display:inline">
                {% csrf_token %}<button class="secondary">Сделать главным</button>
              </form>
            {% endif %}
            <form method="post" action="/panel/photo/{{ ph.pk }}/delete/" style="display:inline">
              {% csrf_token %}<button class="contrast">Удалить</button>
            </form>
          </figcaption>
        </figure>
      {% empty %}
        <p class="muted">Фото пока нет</p>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
