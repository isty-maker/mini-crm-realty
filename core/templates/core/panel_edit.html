{% extends "base.html" %}
{% block title %}{{ prop|default:"Новый объект" }} — Мини-CRM{% endblock %}
{% block content %}
  <a href="/panel/">&larr; к списку</a>
  <h1>{{ prop|default:"Новый объект" }}</h1>

  <form method="post">
    {% csrf_token %}

    <div class="form-row">
      {{ form.category.label_tag }} {{ form.category }}
    </div>
    {% if form.fields.operation %}
      <div class="form-row">
        {{ form.operation.label_tag }} {{ form.operation }}
      </div>
    {% endif %}

    <section class="group">
      <h3>Основное</h3>
      <div class="form-row">
        {{ form.external_id.label_tag }}
        {{ form.external_id }}
      </div>
      <div class="form-row">
        {{ form.title.label_tag }}
        {{ form.title }}
      </div>
      <div class="form-row">
        {{ form.description.label_tag }}
        {{ form.description }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.price.label_tag }}
          {{ form.price }}
        </div>
        <div class="form-row">
          {{ form.currency.label_tag }}
          {{ form.currency }}
        </div>
      </div>
      <div class="form-row">
        <label>{{ form.mortgage_allowed }} {{ form.mortgage_allowed.label }}</label>
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.agent_bonus_value.label_tag }}
          {{ form.agent_bonus_value }}
        </div>
        <div class="form-row">
          <label>{{ form.agent_bonus_is_percent }} {{ form.agent_bonus_is_percent.label }}</label>
        </div>
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.security_deposit.label_tag }}
          {{ form.security_deposit }}
        </div>
        <div class="form-row">
          {{ form.min_rent_term_months.label_tag }}
          {{ form.min_rent_term_months }}
        </div>
      </div>
    </section>

    <section class="group">
      <h3>Площади</h3>
      <div class="form-row">
        {{ form.total_area.label_tag }} {{ form.total_area }}
      </div>
      <div class="form-row">
        {{ form.living_area.label_tag }} {{ form.living_area }}
      </div>
      <div class="form-row">
        {{ form.kitchen_area.label_tag }} {{ form.kitchen_area }}
      </div>
    </section>

    <section class="group">
      <h3>Адрес</h3>
      <div class="form-row">
        {{ form.address.label_tag }}
        {{ form.address }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.lat.label_tag }}
          {{ form.lat }}
        </div>
        <div class="form-row">
          {{ form.lng.label_tag }}
          {{ form.lng }}
        </div>
      </div>
      <div class="form-row">
        {{ form.cadastral_number.label_tag }}
        {{ form.cadastral_number }}
      </div>
    </section>

    <section class="group">
      <h3>Контакты</h3>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.phone_country.label_tag }}
          {{ form.phone_country }}
        </div>
        <div class="form-row">
          {{ form.phone_number.label_tag }}
          {{ form.phone_number }}
        </div>
      </div>
      <div class="form-row">
        {{ form.phone_number2.label_tag }}
        {{ form.phone_number2 }}
      </div>
    </section>

    <section class="group">
      <h3>Медиа</h3>
      <div class="form-row">
        {{ form.layout_photo_url.label_tag }}
        {{ form.layout_photo_url }}
      </div>
      <div class="form-row">
        {{ form.object_tour_url.label_tag }}
        {{ form.object_tour_url }}
      </div>
    </section>

    <section class="group">
      <h3>Здание</h3>
      <div class="form-row">
        {{ form.building_name.label_tag }}
        {{ form.building_name }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.building_floors.label_tag }}
          {{ form.building_floors }}
        </div>
        <div class="form-row">
          {{ form.building_build_year.label_tag }}
          {{ form.building_build_year }}
        </div>
      </div>
      <div class="form-row">
        {{ form.building_material.label_tag }}
        {{ form.building_material }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.building_ceiling_height.label_tag }}
          {{ form.building_ceiling_height }}
        </div>
        <div class="form-row">
          {{ form.building_passenger_lifts.label_tag }}
          {{ form.building_passenger_lifts }}
        </div>
      </div>
      <div class="form-row">
        {{ form.building_cargo_lifts.label_tag }}
        {{ form.building_cargo_lifts }}
      </div>
    </section>

    <section class="group" data-cat="flat,house,room">
      <h3>Характеристики жилья</h3>
      <div class="form-row">
        {{ form.rooms.label_tag }} {{ form.rooms }}
      </div>
      <div class="form-row">
        {{ form.floor_number.label_tag }}
        {{ form.floor_number }}
      </div>
      <div class="form-row">
        {{ form.room_type.label_tag }}
        {{ form.room_type }}
      </div>
      <div class="form-row">
        {{ form.flat_rooms_count.label_tag }}
        {{ form.flat_rooms_count }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.loggias_count.label_tag }}
          {{ form.loggias_count }}
        </div>
        <div class="form-row">
          {{ form.balconies_count.label_tag }}
          {{ form.balconies_count }}
        </div>
      </div>
      <div class="form-row">
        {{ form.windows_view_type.label_tag }}
        {{ form.windows_view_type }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.separate_wcs_count.label_tag }}
          {{ form.separate_wcs_count }}
        </div>
        <div class="form-row">
          {{ form.combined_wcs_count.label_tag }}
          {{ form.combined_wcs_count }}
        </div>
      </div>
      <div class="form-row">
        {{ form.repair_type.label_tag }}
        {{ form.repair_type }}
      </div>
      <div class="form-row">
        <label>{{ form.is_euro_flat }} {{ form.is_euro_flat.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.is_apartments }} {{ form.is_apartments.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.is_penthouse }} {{ form.is_penthouse.label }}</label>
      </div>
    </section>

    <section class="group" data-cat="flat,room">
      <h3>ЖК и корпус</h3>
      <div class="form-row">
        {{ form.jk_id.label_tag }}
        {{ form.jk_id }}
      </div>
      <div class="form-row">
        {{ form.jk_name.label_tag }}
        {{ form.jk_name }}
      </div>
      <div class="form-row">
        {{ form.house_id.label_tag }}
        {{ form.house_id }}
      </div>
      <div class="form-row">
        {{ form.house_name.label_tag }}
        {{ form.house_name }}
      </div>
      <div class="form-row">
        {{ form.flat_number.label_tag }}
        {{ form.flat_number }}
      </div>
      <div class="form-row">
        {{ form.section_number.label_tag }}
        {{ form.section_number }}
      </div>
    </section>

    <section class="group" data-cat="house">
      <h3>Дом</h3>
      <div class="form-row">
        {{ form.heating_type.label_tag }}
        {{ form.heating_type }}
      </div>
      <div class="form-row row-2">
        <div class="form-row">
          {{ form.land_area.label_tag }}
          {{ form.land_area }}
        </div>
        <div class="form-row">
          {{ form.land_area_unit.label_tag }}
          {{ form.land_area_unit }}
        </div>
      </div>
      <div class="form-row">
        {{ form.permitted_land_use.label_tag }}
        {{ form.permitted_land_use }}
      </div>
      <div class="form-row">
        {{ form.land_category.label_tag }}
        {{ form.land_category }}
      </div>
      <div class="form-row">
        <label>{{ form.is_land_with_contract }} {{ form.is_land_with_contract.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_terrace }} {{ form.has_terrace.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_cellar }} {{ form.has_cellar.label }}</label>
      </div>
      <div class="form-row">
        {{ form.ceiling_height.label_tag }}
        {{ form.ceiling_height }}
      </div>
      <div class="form-row">
        {{ form.power.label_tag }}
        {{ form.power }}
      </div>
      <div class="form-row">
        {{ form.parking_places.label_tag }}
        {{ form.parking_places }}
      </div>
      <div class="form-row">
        <label>{{ form.has_parking }} {{ form.has_parking.label }}</label>
      </div>
    </section>

    <section class="group" data-cat="commercial">
      <h3>Коммерция</h3>
      <div class="form-row">
        <label>{{ form.is_rent_by_parts }} {{ form.is_rent_by_parts.label }}</label>
      </div>
      <div class="form-row">
        {{ form.rent_by_parts_desc.label_tag }}
        {{ form.rent_by_parts_desc }}
      </div>
      <div class="form-row">
        {{ form.ceiling_height.label_tag }}
        {{ form.ceiling_height }}
      </div>
      <div class="form-row">
        {{ form.power.label_tag }}
        {{ form.power }}
      </div>
      <div class="form-row">
        {{ form.parking_places.label_tag }}
        {{ form.parking_places }}
      </div>
      <div class="form-row">
        <label>{{ form.has_parking }} {{ form.has_parking.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_ramp }} {{ form.has_ramp.label }}</label>
      </div>
    </section>

    <section class="group" data-cat="flat,room,house">
      <h3>Удобства</h3>
      <div class="form-row">
        <label>{{ form.has_internet }} {{ form.has_internet.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_furniture }} {{ form.has_furniture.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_kitchen_furniture }} {{ form.has_kitchen_furniture.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_tv }} {{ form.has_tv.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_washer }} {{ form.has_washer.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_conditioner }} {{ form.has_conditioner.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_phone }} {{ form.has_phone.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_ramp }} {{ form.has_ramp.label }}</label>
      </div>
      <div class="form-row">
        <label>{{ form.has_bathtub }} {{ form.has_bathtub.label }}</label>
      </div>
    </section>

    <button type="submit">Сохранить</button>
  </form>

  {% if prop %}
    <h3>Фотографии</h3>
    <form method="post" action="/panel/edit/{{ prop.pk }}/add-photo/" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="image" required>
      <label><input type="checkbox" name="is_main"> Сделать главной</label>
      <button>Загрузить</button>
    </form>

    <div class="photos" style="margin-top:1rem">
      {% for ph in photos %}
        <figure>
          <img src="{{ ph.image_url }}" alt="photo {{ forloop.counter }}">
          <figcaption>
            {% if ph.is_main %}
              <span class="tag">главное</span>
            {% else %}
              <form method="post" action="/panel/photo/{{ ph.pk }}/make-main/" style="display:inline">
                {% csrf_token %}<button class="secondary">Сделать главным</button>
              </form>
            {% endif %}
            <form method="post" action="/panel/photo/{{ ph.pk }}/delete/" style="display:inline">
              {% csrf_token %}<button class="contrast">Удалить</button>
            </form>
          </figcaption>
        </figure>
      {% empty %}
        <p class="muted">Фото пока нет</p>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
